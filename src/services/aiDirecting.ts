
// 模擬AIエンジンによる演出強化ロジック
// 将来的にはここでLLM APIを呼び出す想定

const DIRECTING_PRESETS = [
    {
        keywords: ['戦', 'バトル', '攻撃', 'パンチ', 'キック', '剣', '銃', '殴'],
        directions: [
            "【演出:アクション】ローアングルからの煽り構図。インパクトの瞬間に集中線を追加し、背景をぼかして動きを強調。",
            "【演出:迫力】画面対角線を使った大胆な構図。破片や埃のエフェクトを散らし、激しさを表現。",
            "【演出:スピード】強いパースペクティブ。モーションブラーをかけた手足を前面に配置し、奥行き感を強調。",
            "【演出:一瞬の静寂】激しい動きの直前または直後。時間を止めたような「タメ」の構図で、次のアクションの爆発力を予感させる。",
            "【演出:クロスカウンター】二人の攻撃が交差する瞬間をシルエットで表現。背景は稲妻のようなエフェクトで分割。",
        ]
    },
    {
        keywords: ['愛', '好き', '告白', '抱擁', 'キス', '見つめる', '恋'],
        directions: [
            "【演出:ロマンス】ソフトフォーカスと逆光。キャラクターの瞳にハイライトを強調し、背景にキラキラした粒子エフェクト。",
            "【演出:感情】クローズアップ。背景をホワイトアウトまたは抽象的なトーンで処理し、二人の表情に視線を誘導。",
            "【演出:雰囲気】夕暮れまたは木漏れ日のライティング。柔らかな影を落とし、センチメンタルな空気を演出。",
            "【演出:心拍数】背景にドクン...ドクン...という書き文字や、鼓動を表す波紋エフェクトを追加し、緊張感を可視化。",
            "【演出:二人だけの世界】周囲のモブキャラや背景を極端に単純化またはグレーアウトし、二人だけが鮮明に見える演出。",
        ]
    },
    {
        keywords: ['悲', '泣', '涙', '叫', '絶望', '死'],
        directions: [
            "【演出:ドラマ】ハイコントラストな影。雨や暗い背景で心理描写を補強し、顔の半分を影で隠す。",
            "【演出:孤独】広角レンズでのロングショット。キャラクターを小さく配置し、余白を大きく取ることで孤立感を強調。",
            "【演出:衝撃】ダッチアングル（画面を斜めに傾ける）。不安感や精神的なバランスの崩れを視覚的に表現。",
            "【演出:空虚】キャラクターの目からハイライトを消し、背景を荒涼としたトーンに。セリフの吹き出しを小さく、弱々しく配置。",
            "【演出:断絶】コマを物理的に分断するような構図、またはキャラクターの背中越しに見る構図で、拒絶や別れを表現。",
        ]
    },
    {
        keywords: ['笑', 'ギャグ', '爆笑', 'コメディ', '冗談', '変顔'],
        directions: [
            "【演出:ギャグ】背景を単純な集中線やドット柄に。キャラクターを二頭身などのデフォルメ体型（SDキャラ）に一時的に変更。",
            "【演出:漫符】汗、血管マーク、ため息などの漫符を多用し、コミカルさを強調。リアクションを大げさに。",
            "【演出:ツッコミ】背景に「ガーン」や「ドッ」などの擬音を大きく配置。強烈なハリセンや衝撃波のエフェクト。",
            "【演出:シュール】無表情なキャラクターと、ありえない状況の対比。背景を真っ白、または写実的な劇画調にしてギャップを作る。",
        ]
    },
    {
        keywords: ['恐怖', '幽霊', '化け物', '暗闇', '驚', 'ホラー', '怖い'],
        directions: [
            "【演出:ホラー】極端なローアングルでキャラクターを見下ろす視点。目だけを強調したライティング。",
            "【演出:不安】手持ちカメラ風の揺れやブレ。ノイズエフェクトを加え、何かが潜んでいるような不穏な空気を演出。",
            "【演出:ジャンプスケア】コマの枠を突き破るような勢いで対象を描画。黒ベタ背景に白抜きの荒い線で絶叫を表現。",
            "【演出:視線】キャラクターの背後に、誰もいないはずなのに「視線」を感じさせるような構図。背後の闇を強調。",
        ]
    },
    {
        keywords: ['日常', '学校', 'ランチ', '会話', '歩く', '勉強'],
        directions: [
            "【演出:日常】フラットなライティングと安定した構図（アイレベル）。安心感を与える穏やかなコマ運び。",
            "【演出:リズム】会話のキャッチボールに合わせて、コマの大きさを均等に配置。テンポの良い会話劇を演出。",
            "【演出:季節感】窓の外の桜、入道雲、落ち葉などを背景に描き込み、季節と時間の経過をさりげなく表現。",
            "【演出:手元】顔ではなく、コーヒーカップを持つ手やペン回しをする手元のアップで、会話の間や心理状態を表現。",
        ]
    },
    {
        keywords: ['未来', 'ロボット', '宇宙', 'サイバー', '科学', '実験'],
        directions: [
            "【演出:SF】ホログラムのような青白い発光エフェクト。無機質な直線を多用した構図で未来感を演出。",
            "【演出:無重力】浮遊感のある構図。髪の毛や小物が上に向かって漂う描写で、重力からの解放を表現。",
            "【演出:データ】視界にHUD（ヘッドアップディスプレイ）のようなデジタル情報をオーバーレイ表示。",
        ]
    },
    {
        keywords: ['回想', '昔', '子供の頃', '記憶', '思い出す'],
        directions: [
            "【演出:回想】コマの枠線を点線、または角を丸くする処理。全体的にセピア調またはコントラストを下げた色合いに。",
            "【演出:記憶の断片】背景をぼかし、特定のアイテムや人物だけを鮮明に描くことで、記憶の焦点を表現。",
            "【演出:フェード】現在のシーンから徐々に過去のシーンへオーバーラップさせるような遷移演出。",
        ]
    },
    {
        keywords: ['風景', '街', '空', '海', '山', '部屋'],
        directions: [
            "【演出:情景】広角レンズによるエスタブリッシング・ショット。雲の流れや鳥などの動的要素を少し加え、時間の流れを表現。",
            "【演出:詳細】高深度フォーカス。手前の小物から奥の景色までピントを合わせ、世界観のディテールを見せる。",
            "【演出:空気感】空気遠近法を意識。遠景を淡く霞ませ、スケール感と壮大さを演出。",
            "【演出:天候】雨、雪、強い日差しなどの天候描写を強調し、キャラクターの心情とリンクさせる情景描写。",
        ]
    }
];

export const GENERIC_DIRECTIONS = [
    "【演出:強調】キャラクターを三分割法の交点に配置。視線誘導を意識した吹き出し配置。",
    "【演出:ダイナミック】極端なクローズアップ（目元や手元）で、緊張感を高める。",
    "【演出:俯瞰】ハイアングルからのショット。状況の全容を説明しつつ、客観的な視点を提供。",
    "【演出:魚眼】魚眼レンズ効果。中心を歪ませることで、非日常感や混乱した心理状態を表現。",
    "【演出:シルエット】逆光を利用してキャラクターをシルエット化。表情を見せず、背姿やポーズだけで感情を語らせる。",
    "【演出:フレームイン】手前に柱や群衆などの遮蔽物を配置（ナメ構図）。覗き見ているような臨場感と奥行きを演出。",
    "【演出:視線誘導】パースペクティブ（消失点）に向かってキャラクターや背景のラインを集中させ、読者の視線を注視点に導く。",
    "【演出:シンメトリー】画面中央にキャラクターを配置し、左右対称の構図に。威厳、神聖さ、あるいは不自然な静けさを表現。",
    "【演出:コマぶち抜き】極めて重要なアクションや感情の爆発を表現するため、キャラクターやエフェクトがコマの枠線からはみ出す演出。",
    "【演出:リフレクション】鏡、水面、ガラス窓などに映り込んだ姿を描写。内面との対話や、二面性を暗示。",
    "【演出:明暗】キアロスクーロ（明暗対比）。極端に暗い背景と、スポットライトのような強い光で、ドラマチックな緊張感を生む。",
    "【演出:多重露光】同じコマ内に異なる時間のキャラクターを重ねて描画し、素早い動きや時間の経過、または混乱した思考を表現。",
    "【演出:余白】あえて背景を描かず、真っ白（または真っ黒）な空間を大きく取ることで、キャラクターの心理的な孤立や没入感を強調。",
];

export const enhancePanelDescription = async (text: string): Promise<string> => {
    // 擬似的な遅延を追加（API呼び出しのシミュレーション）
    await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 1000));

    let suggestion = "";

    // キーワードマッチング
    const matchedPreset = DIRECTING_PRESETS.find(preset =>
        preset.keywords.some(k => text.includes(k))
    );

    if (matchedPreset) {
        suggestion = matchedPreset.directions[Math.floor(Math.random() * matchedPreset.directions.length)];
    } else {
        suggestion = GENERIC_DIRECTIONS[Math.floor(Math.random() * GENERIC_DIRECTIONS.length)];
    }

    // 重複を避けるための改行処理
    const separator = text.trim() ? "\n" : "";
    return `${text.trim()}${separator}${suggestion}`;
};
